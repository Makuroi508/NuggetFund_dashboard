<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nugget FUND - Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1430 0%, #2d1b4e 100%);
            color: #f0e6d2;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #3d2b5f 0%, #1a1430 100%);
            border: 3px solid #d4af37;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.3),
                        inset 0 0 20px rgba(212, 175, 55, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #d4af37, #f0e6d2, #d4af37);
            border-radius: 15px;
            z-index: -1;
            opacity: 0.3;
            filter: blur(10px);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .fund-name {
            font-size: 2.5em;
            font-weight: bold;
            color: #d4af37;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5),
                         0 0 20px rgba(212, 175, 55, 0.3);
            letter-spacing: 2px;
        }

        .timezone-live {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .timezone-selector {
            position: relative;
        }

        .timezone-label {
            background: rgba(212, 175, 55, 0.1);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #d4af37;
            font-size: 0.9em;
            color: #f0e6d2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #timezoneSelect {
            background: rgba(26, 20, 48, 0.95);
            border: 1px solid #d4af37;
            border-radius: 5px;
            padding: 5px 10px;
            color: #d4af37;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            cursor: pointer;
            outline: none;
        }

        #timezoneSelect option {
            background: rgba(26, 20, 48, 0.95);
            color: #f0e6d2;
            padding: 5px;
        }

        #timezoneSelect:hover {
            background: rgba(61, 43, 95, 0.95);
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(76, 175, 80, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #4CAF50;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .tagline {
            font-size: 1.1em;
            color: #b8a07e;
            font-style: italic;
            text-align: center;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2d1b4e 0%, #1a1430 100%);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }

        .stat-label {
            font-size: 0.85em;
            color: #b8a07e;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #d4af37;
        }

        .stat-value.positive {
            color: #4CAF50;
        }

        .stat-value.negative {
            color: #e74c3c;
        }

        /* Equity Curve */
        .chart-section {
            background: linear-gradient(135deg, #2d1b4e 0%, #1a1430 100%);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.3em;
            color: #d4af37;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title::before {
            content: 'ðŸ“ˆ';
            font-size: 1.2em;
        }

        .last-updated {
            font-size: 0.85em;
            color: #b8a07e;
        }

        #equityChart {
            max-height: 400px;
        }

        /* Date Filter */
        .filter-section {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid #d4af37;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-label {
            color: #d4af37;
            font-weight: bold;
        }

        .filter-input {
            background: rgba(26, 20, 48, 0.8);
            border: 1px solid #d4af37;
            border-radius: 5px;
            padding: 8px 12px;
            color: #f0e6d2;
            font-family: 'Courier New', monospace;
        }

        .filter-button {
            background: linear-gradient(135deg, #d4af37 0%, #b8a07e 100%);
            border: none;
            border-radius: 5px;
            padding: 8px 20px;
            color: #1a1430;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .filter-button:hover {
            transform: scale(1.05);
        }

        /* Trade History */
        .table-section {
            background: linear-gradient(135deg, #2d1b4e 0%, #1a1430 100%);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }

        .table-title {
            font-size: 1.3em;
            color: #d4af37;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-title::before {
            content: 'ðŸ“‹';
            font-size: 1.2em;
        }

        /* SCROLLABLE TABLE WRAPPER */
        .table-wrapper {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: auto;
            border-radius: 5px;
        }

        /* Custom Scrollbar */
        .table-wrapper::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: rgba(26, 20, 48, 0.5);
            border-radius: 10px;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.5);
            border-radius: 10px;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.8);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: rgba(212, 175, 55, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 15px;
            text-align: left;
            color: #d4af37;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85em;
            border-bottom: 2px solid #d4af37;
            background: rgba(26, 20, 48, 0.95);
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            color: #f0e6d2;
            white-space: nowrap;
        }

        tbody tr {
            transition: background 0.3s;
        }

        tbody tr:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .action-long {
            color: #4CAF50;
            font-weight: bold;
        }

        .action-short {
            color: #e74c3c;
            font-weight: bold;
        }

        .pnl-positive {
            color: #4CAF50;
            font-weight: bold;
        }

        .pnl-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #d4af37;
        }

        .error {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #f0e6d2;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .fund-name {
                font-size: 1.8em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
            }

            .table-wrapper {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="fund-name" id="fundName">NUGGET FUND RECOVERY PORTFOLIO</div>
                <div class="timezone-live">
                    <div class="timezone-selector">
                        <div class="timezone-label">
                            <span>TIMEZONE:</span>
                            <select id="timezoneSelect" onchange="changeTimezone()">
                                <option value="9">UTC+9 (KST)</option>
                                <option value="0">UTC+0</option>
                                <option value="-5">UTC-5 (EST)</option>
                                <option value="-8">UTC-8 (PST)</option>
                                <option value="0">UTC+0 (GMT)</option>
                                <option value="9">UTC+9 (JST)</option>
                                <option value="8">UTC+8 (CST)</option>
                                <option value="11">UTC+11 (AEDT)</option>
                            </select>
                        </div>
                    </div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live â€¢ <span id="tradeCount">0</span> trades</span>
                    </div>
                </div>
            </div>
            <div class="tagline">Never Give Up! Never Surrender!.</div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <div class="loading">Loading portfolio data...</div>
        </div>

        <!-- Date Filter -->
        <div class="filter-section">
            <span class="filter-label">Filter by Date:</span>
            <input type="date" class="filter-input" id="startDate">
            <span>to</span>
            <input type="date" class="filter-input" id="endDate">
            <button class="filter-button" onclick="applyFilter()">Apply Filter</button>
            <button class="filter-button" onclick="clearFilter()">Clear Filter</button>
        </div>

        <!-- Equity Curve -->
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title">EQUITY CURVE</div>
                <div class="last-updated" id="lastUpdated">Last updated: --</div>
            </div>
            <canvas id="equityChart"></canvas>
        </div>

        <!-- Trade History -->
        <div class="table-section">
            <div class="table-title">TRADE HISTORY</div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>DATE</th>
                            <th>PAIR</th>
                            <th>ACTION</th>
                            <th>ENTRY</th>
                            <th>EXIT</th>
                            <th>SIZE</th>
                            <th>PNL</th>
                            <th>PNL %</th>
                        </tr>
                    </thead>
                    <tbody id="tradeHistory">
                        <tr>
                            <td colspan="8" class="loading">Loading trade history...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION - Replace with your Google Apps Script Web App URL
        const API_URL = 'https://script.google.com/macros/s/AKfycbxsyNrzEDUWRReszVTCWukboMHz95BfTnO32q-j6dzsz0KTHB-WT1nbkv4ncy7-05L9rQ/exec';
        
        let allData = null;
        let filteredTrades = null;
        let equityChart = null;
        let currentTimezoneOffset = 9; // Default UTC+9 (KST)

        // Timezone conversion helper
        function convertToTimezone(dateString, offsetHours) {
            const date = new Date(dateString);
            // Convert to UTC first, then apply offset
            const utc = date.getTime() + (date.getTimezoneOffset() * 60000);
            const newDate = new Date(utc + (3600000 * offsetHours));
            
            // Format: "Fri Dec 12 2025 21:04:00"
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            const dayName = days[newDate.getDay()];
            const monthName = months[newDate.getMonth()];
            const day = newDate.getDate();
            const year = newDate.getFullYear();
            const hours = String(newDate.getHours()).padStart(2, '0');
            const minutes = String(newDate.getMinutes()).padStart(2, '0');
            const seconds = String(newDate.getSeconds()).padStart(2, '0');
            
            return `${dayName} ${monthName} ${day} ${year} ${hours}:${minutes}:${seconds}`;
        }

        function changeTimezone() {
            const select = document.getElementById('timezoneSelect');
            currentTimezoneOffset = parseInt(select.value);
            updateDashboard();
        }

        // Load data on page load
        window.addEventListener('load', () => {
            loadData();
            // Refresh every 5 minutes
            setInterval(loadData, 5 * 60 * 1000);
        });

        async function loadData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to load data');
                }
                
                allData = data;
                filteredTrades = data.trades;
                
                updateDashboard();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError(error.message);
            }
        }

        function updateDashboard() {
            if (!allData) return;
            
            // Update header
            document.getElementById('fundName').textContent = allData.config.fundName;
            document.getElementById('tradeCount').textContent = filteredTrades.length;
            document.getElementById('lastUpdated').textContent = 
                `Last updated: ${new Date(allData.timestamp).toLocaleString()}`;
            
            // Update stats
            updateStats();
            
            // Update chart
            updateChart();
            
            // Update trade history
            updateTradeHistory();
        }

        function updateStats() {
            const stats = calculateFilteredStats();
            
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">Starting Capital</div>
                    <div class="stat-value">$${stats.startingCapital}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Current Equity</div>
                    <div class="stat-value">$${stats.currentEquity}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Total Return</div>
                    <div class="stat-value ${parseFloat(stats.totalReturn) >= 0 ? 'positive' : 'negative'}">
                        ${parseFloat(stats.totalReturn) >= 0 ? '+' : ''}$${stats.totalReturn}
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">ROI %</div>
                    <div class="stat-value ${parseFloat(stats.roiPercent) >= 0 ? 'positive' : 'negative'}">
                        ${parseFloat(stats.roiPercent) >= 0 ? '+' : ''}${stats.roiPercent}%
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Max Drawdown</div>
                    <div class="stat-value negative">-${stats.maxDrawdown}%</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Win Rate</div>
                    <div class="stat-value">${stats.winRate}%</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Total Trades</div>
                    <div class="stat-value">${stats.totalTrades}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Profitable Trades</div>
                    <div class="stat-value positive">${stats.profitableTrades}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Avg Win</div>
                    <div class="stat-value positive">$${stats.avgWin}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Avg Loss</div>
                    <div class="stat-value negative">$${stats.avgLoss}</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-label">Sharpe Ratio</div>
                    <div class="stat-value">${stats.sharpeRatio}</div>
                </div>
            `;
            
            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        function calculateFilteredStats() {
            if (filteredTrades.length === 0) {
                return allData.stats;
            }
            
            const startingCapital = parseFloat(allData.stats.startingCapital);
            let currentEquity = startingCapital;
            let peak = startingCapital;
            let maxDD = 0;
            let wins = 0;
            let totalWinAmount = 0;
            let totalLossAmount = 0;
            
            filteredTrades.forEach(trade => {
                const pnl = parseFloat(trade.pnl);
                currentEquity += pnl;
                
                if (currentEquity > peak) peak = currentEquity;
                const dd = ((peak - currentEquity) / peak) * 100;
                if (dd > maxDD) maxDD = dd;
                
                if (pnl > 0) {
                    wins++;
                    totalWinAmount += pnl;
                } else if (pnl < 0) {
                    totalLossAmount += Math.abs(pnl);
                }
            });
            
            const totalReturn = currentEquity - startingCapital;
            const roiPercent = (totalReturn / startingCapital) * 100;
            const winRate = (wins / filteredTrades.length) * 100;
            const avgWin = wins > 0 ? totalWinAmount / wins : 0;
            const avgLoss = (filteredTrades.length - wins) > 0 ? 
                totalLossAmount / (filteredTrades.length - wins) : 0;
            
            // Calculate Sharpe for filtered data
            const returns = [];
            let equity = startingCapital;
            filteredTrades.forEach(trade => {
                const pnl = parseFloat(trade.pnl);
                returns.push((pnl / equity) * 100);
                equity += pnl;
            });
            
            const meanReturn = returns.reduce((sum, r) => sum + r, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - meanReturn, 2), 0) / returns.length;
            const stdDev = Math.sqrt(variance);
            const sharpeRatio = stdDev !== 0 ? meanReturn / stdDev : 0;
            
            return {
                startingCapital: startingCapital.toFixed(2),
                currentEquity: currentEquity.toFixed(2),
                totalReturn: totalReturn.toFixed(2),
                roiPercent: roiPercent.toFixed(2),
                maxDrawdown: maxDD.toFixed(2),
                winRate: winRate.toFixed(1),
                totalTrades: filteredTrades.length,
                profitableTrades: wins,
                avgWin: avgWin.toFixed(2),
                avgLoss: avgLoss.toFixed(2),
                sharpeRatio: sharpeRatio.toFixed(2)
            };
        }

        function updateChart() {
            const ctx = document.getElementById('equityChart').getContext('2d');
            
            // Calculate equity curve from filtered trades
            const startingCapital = parseFloat(allData.stats.startingCapital);
            let equity = startingCapital;
            
            const labels = [allData.config.startDate];
            const data = [startingCapital];
            const tradeDetails = [null]; // No trade for starting point
            
            filteredTrades.forEach(trade => {
                equity += parseFloat(trade.pnl);
                // Convert label to selected timezone
                const convertedDate = convertToTimezone(trade.date, currentTimezoneOffset);
                labels.push(convertedDate.split(' ').slice(1, 3).join(' ')); // Just "Dec 12" format
                data.push(equity);
                tradeDetails.push(trade);
            });
            
            if (equityChart) {
                equityChart.destroy();
            }
            
            equityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Equity',
                        data: data,
                        borderColor: '#d4af37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 8,
                        pointHoverBackgroundColor: '#d4af37',
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 20, 48, 0.95)',
                            titleColor: '#d4af37',
                            bodyColor: '#f0e6d2',
                            borderColor: '#d4af37',
                            borderWidth: 2,
                            padding: 15,
                            displayColors: false,
                            callbacks: {
                                title: function(context) {
                                    const trade = tradeDetails[context[0].dataIndex];
                                    if (!trade) return allData.config.startDate;
                                    return convertToTimezone(trade.date, currentTimezoneOffset);
                                },
                                label: function(context) {
                                    const equity = context.parsed.y;
                                    const trade = tradeDetails[context.dataIndex];
                                    
                                    if (!trade) {
                                        return 'Equity: $' + equity.toFixed(2);
                                    }
                                    
                                    const pnl = parseFloat(trade.pnl);
                                    const pnlPercent = parseFloat(trade.pnlPercent);
                                    
                                    return [
                                        'Equity: $' + equity.toFixed(2),
                                        '',
                                        'Trade: ' + trade.pair + ' ' + trade.action,
                                        'Entry: $' + trade.entry,
                                        'Exit: $' + trade.exit,
                                        'Size: $' + trade.size,
                                        'PnL: ' + (pnl >= 0 ? '+' : '') + '$' + trade.pnl + ' (' + (pnlPercent >= 0 ? '+' : '') + trade.pnlPercent + '%)'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#b8a07e',
                                maxRotation: 0,
                                minRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 8
                            },
                            grid: {
                                color: 'rgba(212, 175, 55, 0.1)',
                                display: true
                            }
                        },
                        y: {
                            ticks: {
                                color: '#b8a07e',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            },
                            grid: {
                                color: 'rgba(212, 175, 55, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function updateTradeHistory() {
            const tbody = document.getElementById('tradeHistory');
            
            if (filteredTrades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No trades found</td></tr>';
                return;
            }
            
            const html = filteredTrades.map(trade => {
                const pnl = parseFloat(trade.pnl);
                const pnlPercent = parseFloat(trade.pnlPercent);
                
                // Convert date to selected timezone
                const convertedDate = convertToTimezone(trade.date, currentTimezoneOffset);
                
                return `
                    <tr>
                        <td>${convertedDate}</td>
                        <td>${trade.pair}</td>
                        <td class="action-${trade.action.toLowerCase()}">${trade.action}</td>
                        <td>$${trade.entry}</td>
                        <td>$${trade.exit}</td>
                        <td>$${trade.size}</td>
                        <td class="${pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                            ${pnl >= 0 ? '+' : ''}$${trade.pnl}
                        </td>
                        <td class="${pnlPercent >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                            ${pnlPercent >= 0 ? '+' : ''}${trade.pnlPercent}%
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }

        function applyFilter() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate && !endDate) {
                alert('Please select at least one date');
                return;
            }
            
            filteredTrades = allData.trades.filter(trade => {
                const tradeDate = new Date(trade.date);
                const start = startDate ? new Date(startDate) : new Date('1970-01-01');
                const end = endDate ? new Date(endDate) : new Date('2099-12-31');
                
                return tradeDate >= start && tradeDate <= end;
            });
            
            updateDashboard();
        }

        function clearFilter() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            filteredTrades = allData.trades;
            updateDashboard();
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorHTML = `
                <div class="error">
                    <h3>Error Loading Data</h3>
                    <p>${message}</p>
                    <p>Please check your Google Apps Script URL and deployment settings.</p>
                </div>
            `;
            container.insertAdjacentHTML('afterbegin', errorHTML);
        }
    </script>
</body>
</html>
